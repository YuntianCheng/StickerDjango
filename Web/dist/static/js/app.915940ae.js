(function(t){function e(e){for(var i,s,o=e[0],c=e[1],l=e[2],h=0,u=[];h<o.length;h++)s=o[h],Object.prototype.hasOwnProperty.call(n,s)&&n[s]&&u.push(n[s][0]),n[s]=0;for(i in c)Object.prototype.hasOwnProperty.call(c,i)&&(t[i]=c[i]);d&&d(e);while(u.length)u.shift()();return r.push.apply(r,l||[]),a()}function a(){for(var t,e=0;e<r.length;e++){for(var a=r[e],i=!0,o=1;o<a.length;o++){var c=a[o];0!==n[c]&&(i=!1)}i&&(r.splice(e--,1),t=s(s.s=a[0]))}return t}var i={},n={app:0},r=[];function s(e){if(i[e])return i[e].exports;var a=i[e]={i:e,l:!1,exports:{}};return t[e].call(a.exports,a,a.exports,s),a.l=!0,a.exports}s.m=t,s.c=i,s.d=function(t,e,a){s.o(t,e)||Object.defineProperty(t,e,{enumerable:!0,get:a})},s.r=function(t){"undefined"!==typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(t,"__esModule",{value:!0})},s.t=function(t,e){if(1&e&&(t=s(t)),8&e)return t;if(4&e&&"object"===typeof t&&t&&t.__esModule)return t;var a=Object.create(null);if(s.r(a),Object.defineProperty(a,"default",{enumerable:!0,value:t}),2&e&&"string"!=typeof t)for(var i in t)s.d(a,i,function(e){return t[e]}.bind(null,i));return a},s.n=function(t){var e=t&&t.__esModule?function(){return t["default"]}:function(){return t};return s.d(e,"a",e),e},s.o=function(t,e){return Object.prototype.hasOwnProperty.call(t,e)},s.p="/";var o=window["webpackJsonp"]=window["webpackJsonp"]||[],c=o.push.bind(o);o.push=e,o=o.slice();for(var l=0;l<o.length;l++)e(o[l]);var d=c;r.push([0,"chunk-vendors"]),a()})({0:function(t,e,a){t.exports=a("56d7")},"034f":function(t,e,a){"use strict";a("64a9")},"129c":function(t,e,a){t.exports=a.p+"static/img/6.916e880b.jpg"},2144:function(t,e,a){t.exports=a.p+"static/img/7.e780dc37.jpg"},4762:function(t,e,a){"use strict";a("d345")},"546a":function(t,e,a){t.exports=a.p+"static/img/5.43896059.jpg"},"56d7":function(t,e,a){"use strict";a.r(e);a("cadf"),a("551c"),a("f751"),a("097d");var i=a("2b0e"),n=function(){var t=this,e=this,a=e.$createElement,i=e._self._c||a;return i("div",{ref:"app",attrs:{id:"app"}},[i("el-card",{staticClass:"card",attrs:{shadow:"always"}},[i("el-row",{attrs:{type:"flex",justify:"center"}},[i("el-col",[i("el-steps",{attrs:{active:e.active,"finish-status":"success","align-center":""}},[i("el-step",{attrs:{title:"选取图片"}}),i("el-step",{attrs:{title:"选择模版"}}),i("el-step",{attrs:{title:"生成表情包"}})],1)],1)],1),i("el-row",{attrs:{type:"flex",justify:"center"}},[i("el-col",[i("div",{ref:"main",staticStyle:{"margin-top":"20px"}},[i("el-row",{attrs:{type:"flex",justify:"center"}},[i("el-col",{attrs:{span:16}},[1==e.active?i("el-tabs",{on:{"tab-click":e.handleTab},model:{value:e.activeTab,callback:function(t){e.activeTab=t},expression:"activeTab"}},[i("el-tab-pane",{attrs:{name:"file",label:"上传照片"}},[i("photograph",{on:{upload:e.upload},model:{value:e.headImage,callback:function(t){e.headImage=t},expression:"headImage"}})],1),i("el-tab-pane",{attrs:{name:"camera",label:"手动拍照"}},[i("el-row",{attrs:{gutter:10,type:"flex",justify:"center"}},[i("el-col",[i("video",{attrs:{id:"videoCamera",width:e.videoWidth,height:e.videoHeight,autoplay:""}}),i("canvas",{staticStyle:{display:"none"},attrs:{id:"canvasCamera",width:e.videoWidth,height:e.videoHeight}})]),i("el-col",[i("div",[i("el-button",{staticStyle:{"margin-top":"110px"},attrs:{type:"success",icon:"el-icon-camera-solid"},on:{click:function(t){return e.setImage()}}})],1)]),i("el-col",[i("div",{staticClass:"img_bg_camera"},[i("img",{staticClass:"tx_img",attrs:{src:e.imgSrc,alt:"",width:"videoWidth",height:"videoHeight"}})])])],1)],1)],1):e._e()],1)],1),2==e.active?i("el-row",{attrs:{gutter:20,type:"flex",justify:"center"}},[i("el-col",{attrs:{span:9}},[i("el-card",[i("div",{attrs:{slot:"header"},slot:"header"},[i("span",[e._v("选择模版")])]),i("div",[i("el-table",{ref:"faceTable",staticStyle:{width:"260px"},attrs:{"show-header":!1,"highlight-current-row":"",data:e.tableData,height:250,"max-height":250},on:{"row-click":e.handleSelect}},[i("el-table-column",{attrs:{width:"2px"}}),i("el-table-column",{scopedSlots:e._u([{key:"default",fn:function(t){return[i("el-card",[i("el-image",{staticStyle:{width:"200px",height:"200px"},attrs:{src:t.row.img}})],1)]}}],null,!1,2901843003)})],1)],1)])],1),i("el-col",{attrs:{span:9}},[i("el-card",[i("div",{attrs:{slot:"header"},slot:"header"},[i("span",[e._v("模版描述")])]),i("div",{staticStyle:{height:"250px"}},[i("span",{staticStyle:{"margin-top":"20%"}},[e._v(e._s(e.description))])])])],1)],1):e._e(),3==e.active?i("el-row",{attrs:{type:"flex",justify:"center"}},[i("el-col",{attrs:{span:12}},[i("el-image",{directives:[{name:"loading",rawName:"v-loading",value:e.loading,expression:"loading"}],staticStyle:{width:"400px",height:"400px"},attrs:{"element-loading-text":"表情包生成中","element-loading-spinner":"el-icon-loading",src:e.face,fit:e.fit}})],1)],1):e._e()],1)])],1),i("el-row",{staticStyle:{"margin-top":"10px"},attrs:{type:"flex",justify:"center"}},[3!=e.active?i("el-col",{attrs:{span:3}},[i("el-button",{attrs:{disabled:e.next,type:"primary"},on:{click:e.nextStep}},[e._v("下一步")])],1):e._e(),2==e.active?i("el-col",{attrs:{span:3}},[i("el-button",{on:{click:e.preStep}},[e._v("上一步")])],1):e._e(),3==e.active?i("el-col",{attrs:{span:6}},[i("el-button",{attrs:{type:"primary"},on:{click:e.save}},[e._v("保存")]),i("el-button",{attrs:{type:"danger"},on:{click:function(){t.active=1,t.activeTab="file"}}},[e._v("重新开始")])],1):e._e()],1)],1)],1)},r=[],s=(a("34ef"),a("4917"),a("28a5"),a("7f7f"),a("6b54"),function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("div",{ref:"avatar",staticClass:"avatar",class:{complete:t.headerImage}},[a("input",{staticClass:"avatar-file",attrs:{type:"file",name:"",id:"avatar",accept:"image/*"},on:{change:t.uploadFile}}),a("label",{staticClass:"avatar-label",attrs:{for:"avatar"}})])}),o=[],c=a("6f45"),l=a.n(c),d={name:"photograph",data:function(){return{headerImage:"",avatarFile:""}},methods:{uploadFile:function(t){var e=t.target.files||t.dataTransfer.files;e.length&&(this.avatarFile=e[0],this.imgPreview(this.avatarFile))},imgPreview:function(t){var e,a=this;if(l.a.getData(t,(function(){e=l.a.getTag(this,"Orientation")})),t&&window.FileReader&&/^image/.test(t.type)){var i=new FileReader;i.readAsDataURL(t),i.onloadend=function(){var t=this.result,i=new Image;i.src=t,this.result.length<=102400?(a.headerImage=this.result,a.postImg()):i.onload=function(){var t=a.compress(i,e);a.headerImage=t,a.postImg()}}}},postImg:function(){this.$emit("upload",this.avatarFile),this.$emit("input",this.avatarFile),this.$refs.avatar.style.background="url(".concat(this.headerImage,")no-repeat center/contain")},rotateImg:function(t,e,a){var i=0,n=3;if(null!=t){var r=t.height,s=t.width,o=2;null==o&&(o=i),"right"===e?(o++,o>n&&(o=i)):(o--,o<i&&(o=n));var c=90*o*Math.PI/180,l=a.getContext("2d");switch(o){case 0:a.width=s,a.height=r,l.drawImage(t,0,0);break;case 1:a.width=r,a.height=s,l.rotate(c),l.drawImage(t,0,-r);break;case 2:a.width=s,a.height=r,l.rotate(c),l.drawImage(t,-s,-r);break;case 3:a.width=r,a.height=s,l.rotate(c),l.drawImage(t,-s,0);break}}},compress:function(t,e){var a,i,n=document.createElement("canvas"),r=n.getContext("2d"),s=document.createElement("canvas"),o=s.getContext("2d"),c=t.width,l=t.height;if((a=c*l/4e6)>1?(a=Math.sqrt(a),c/=a,l/=a):a=1,n.width=c,n.height=l,r.fillStyle="#fff",r.fillRect(0,0,n.width,n.height),(i=c*l/1e6)>1){i=~~(Math.sqrt(i)+1);var d=~~(c/i),h=~~(l/i);s.width=d,s.height=h;for(var u=0;u<i;u++)for(var p=0;p<i;p++)o.drawImage(t,u*d*a,p*h*a,d*a,h*a,0,0,d,h),r.drawImage(s,u*d,p*h,d,h)}else r.drawImage(t,0,0,c,l);if(""!==e&&1!==e)switch(e){case 6:this.rotateImg(t,"left",n);break;case 8:this.rotateImg(t,"right",n);break;case 3:this.rotateImg(t,"right",n),this.rotateImg(t,"right",n);break}var g=n.toDataURL("image/jpeg",.1);return s.width=s.height=n.width=n.height=0,g}}},h=d,u=(a("4762"),a("2877")),p=Object(u["a"])(h,s,o,!1,null,"6927e26b",null),g=p.exports,f=a("a2ba"),v=a.n(f),m=7,b=["化身马老师痛斥现在的年轻人不讲武德，建议搭配气急败坏照片","武林风气不佳，规劝大家不要搞内斗，建议搭配痛心疾首照片","粗心大意之下被偷袭成功，以自身经历告诉大家随时保持警惕，建议搭配挨打后的照片","69岁的老人被偷袭，是道德的沦丧，还是人性的泯灭，化身69岁老同志对年轻人发出抗议，建议搭配急了的照片","奉劝年轻人好自为之，展现自己大度的一面，建议搭配一脸深沉照片","看见大佬的激动之情溢于言表，展现自己迷弟迷妹的一面，建议搭配花痴照片","阴险狡诈之辈专用，偷袭前发送可干扰对方判断，建议搭配贼眉鼠眼照片"],w=a("d225"),y=a("b0b4"),x=a("bc3a"),j=a.n(x),I=function(){function t(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:baseURL;Object(w["a"])(this,t),this.baseUrl=e,this.queue={}}return Object(y["a"])(t,[{key:"getInsideConfig",value:function(){var t={baseURL:this.baseUrl,headers:{}};return t}},{key:"destroy",value:function(t){delete this.queue[t]}},{key:"interceptors",value:function(t,e){var a=this;t.interceptors.request.use((function(t){return a.queue[e]=!0,t}),(function(t){return Promise.reject(t)})),t.interceptors.response.use((function(t){a.destroy(e);var i=t.data,n=t.status,r=t.headers;return{data:i,status:n,headers:r}}),(function(t){a.destroy(e);t.response;return 401===status&&window.location.reload(),Promise.reject(t)}))}},{key:"request",value:function(t){var e=j.a.create({}),a=this.getInsideConfig();return t=Object.assign(a,t),this.interceptors(e,t.url),e(t)}}]),t}(),k=I,_={dev:"",pro:""},C=!1,O=C?_.dev:_.pro,S={projectName:"表情包生成器",isDev:C,url:O,cookieExpires:1,useI18n:!0,baseUrl:_},U=S.baseUrl.pro,T=new k(U),D=T;function F(t){return D.request({url:"/api/get_sticks/",headers:{"Content-Type":"multipart/form-data"},method:"post",data:t,responseType:"blob"})}var M=a("9afa"),P=a.n(M),R={name:"app",components:{Photograph:g},data:function(){return{activeTab:"file",headImage:"",disabled:!0,next:!0,tableData:[],select:null,face:null,noView:v.a,active:1,loading:!0,description:"",videoWidth:250,videoHeight:300,imgSrc:"",thisCancas:null,thisContext:null,thisVideo:null}},methods:{upload:function(){this.next=!1},handleSelect:function(t){this.$refs.faceTable.setCurrentRow(t),this.disabled=!1,this.next=!1,this.select=t.imgIndex,this.description=b[t.imgIndex-1]},Init:function(){for(var t={color:"0,0,255",count:200},e=(new P.a(this.$refs["app"],t),1);e<=m;e++)this.tableData.push({imgIndex:e,img:a("b5a1")("./"+e.toString()+".jpg")})},handleTab:function(t){"camera"==t.name?this.getCompetence():this.stopNavigator()},handleFace:function(){var t=this;this.loading=!0;var e=new FormData;e.append("name",this.select),e.append("image",this.headImage),F(e).then((function(e){t.loading=!1,t.face=window.URL.createObjectURL(e.data)}))},nextStep:function(){this.active++,this.next=!0,2==this.active&&this.stopNavigator(),3==this.active&&this.handleFace(),console.log(this.headImage)},preStep:function(){2==this.active&&(this.activeTab="file"),this.active--},save:function(){var t=document.createElement("a");t.href=this.face,t.download="stick.jpg",t.click()},getCompetence:function(){var t=this;this.thisCancas=document.getElementById("canvasCamera"),this.thisContext=this.thisCancas.getContext("2d"),this.thisVideo=document.getElementById("videoCamera"),void 0===navigator.mediaDevices&&(navigator.mediaDevices={}),void 0===navigator.mediaDevices.getUserMedia&&(navigator.mediaDevices.getUserMedia=function(t){var e=navigator.webkitGetUserMedia||navigator.mozGetUserMedia||navigator.getUserMedia;return e?new Promise((function(a,i){e.call(navigator,t,a,i)})):Promise.reject(new Error("getUserMedia is not implemented in this browser"))});var e={audio:!1,video:{width:this.videoWidth,height:this.videoHeight,transform:"scaleX(-1)"}};navigator.mediaDevices.getUserMedia(e).then((function(e){"srcObject"in t.thisVideo?t.thisVideo.srcObject=e:t.thisVideo.src=window.URL.createObjectURL(e),t.thisVideo.onloadedmetadata=function(e){t.thisVideo.play()}})).catch((function(t){console.log(t)}))},setImage:function(){var t=this,e=this;e.thisContext.drawImage(e.thisVideo,0,0,e.videoWidth,e.videoHeight),this.thisCancas.toBlob((function(e){t.headImage=e}),"image/jpeg");var a=this.thisCancas.toDataURL("image/jpeg");e.imgSrc=a,e.next=!1},dataURLtoFile:function(t,e){var a=t.split(","),i=a[0].match(/:(.*?);/)[1],n=atob(a[1]),r=n.length,s=new Uint8Array(r);while(r--)s[r]=n.charCodeAt(r);return new File([s],e,{type:i})},stopNavigator:function(){this.thisVideo.srcObject.getTracks()[0].stop()}},mounted:function(){this.Init()}},V=R,E=(a("034f"),Object(u["a"])(V,n,r,!1,null,null,null)),L=E.exports,q=a("5c96"),$=a.n(q);a("0fae");i["default"].use($.a),i["default"].config.productionTip=!1,new i["default"]({render:function(t){return t(L)}}).$mount("#app")},"593c":function(t,e,a){t.exports=a.p+"static/img/2.c5fe1dd1.jpg"},"64a9":function(t,e,a){},6800:function(t,e,a){t.exports=a.p+"static/img/3.e7dc703f.jpg"},"98a8":function(t,e,a){t.exports=a.p+"static/img/1.3f66f7ce.jpg"},a2ba:function(t,e,a){t.exports=a.p+"static/img/noView.2f191c96.jpg"},b5a1:function(t,e,a){var i={"./1.jpg":"98a8","./2.jpg":"593c","./3.jpg":"6800","./4.jpg":"ffd7","./5.jpg":"546a","./6.jpg":"129c","./7.jpg":"2144","./noView.jpg":"a2ba"};function n(t){var e=r(t);return a(e)}function r(t){if(!a.o(i,t)){var e=new Error("Cannot find module '"+t+"'");throw e.code="MODULE_NOT_FOUND",e}return i[t]}n.keys=function(){return Object.keys(i)},n.resolve=r,t.exports=n,n.id="b5a1"},d345:function(t,e,a){},ffd7:function(t,e,a){t.exports=a.p+"static/img/4.a0e81b62.jpg"}});
//# sourceMappingURL=app.915940ae.js.map